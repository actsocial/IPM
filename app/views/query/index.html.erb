<h1>Query</h1>

<form class="form-inline" role="form">
	<select class="form-control" id="brand-select">
		<%@brands.each do |brand|%>
			<option value="<%= brand.id %>"><%= brand.name%></option>
		<% end%>
	</select>
	<button type="button" class="btn btn-info">Search</button>
		
</form>

<table id="resultTable">
	<thead>
        <tr>
            <th>Image</th>
            <th>Title</th>
            <th>Location</th>
            <th>Price</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<script>
	$(document).ready(function() {
    $('#resultTable').dataTable({
    	 "sDom": '<"div">rt<"div"lp>',
    	"bProcessing": true,
        "sAjaxSource": '/query/query.json',
        "aoColumns": [
            { "mData": "image" },
            { "mData": "title" },
            { "mData": "location" },
            { "mData": "price" },
            { "mData": "status" },
            { "mData": "action" }
        ],
        "aoColumnDefs": [
        	{
        		"mRender": function( data, type, row ) {
                    return "<img src='"+ row['image'] +"'>";
	            },
	            "aTargets": [0]
        	},
        	{
        		"mRender": function( data, type, row ) {
                    return "<a target='_blank' href='"+ row['url'] +"'>"+row['title']+"</a>";
	            },
	            "aTargets": [1]
        	}
        ],
        "fnServerParams": function ( aoData ) {
            aoData.push( { "name":"brand_id", "value": $("#brand-select").val()} );
        }
    });
    
//    $('#resultTable tbody').on('dblclick', 'tr', function () {
//    	
//    });
});
</script>
