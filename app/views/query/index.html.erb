
<div class="form-inline" role="form">
  <div class="form-group">
    <select  id="brand-select" class="form-control">
    <% @brands.each do |brand|%>
        <option value="<%= brand.id %>"><%= brand.name%></option>
    <% end%>
    </select>
  </div>
  <div class="form-group">
    <input type="input" class="form-control" id="keyword-filter" placeholder="input keywords">
  </div>
  <div class="form-group">
    <div class="row">
        <div class="col-lg-1">Price</div>
        <div class="col-lg-2">
         <input type="input" class="form-control" id="price_start" placeholder="">
        </div>
        <div class="col-lg-1">-</div>
        <div class="col-lg-2">
         <input type="input" class="form-control" id="price_end" placeholder="">
        </div>
    </div>
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox">Taobao
    </label>
  </div>
  <button class="btn btn-danger" id="complain">Complain</button>
</div>

<table id="resultTable" class="table">
	<thead>
        <tr>
        	<th></th>
            <th>Image</th>
            <th>Title</th>
            <th>Location</th>
            <th>Price</th>
            <th>Seller</th>
            <th>Tag</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<div class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Confirm</h4>
      </div>
      <div class="modal-body">
        <p><span id="selectedCount" style="color:red"></span> links selected.</p>
        <p id="selectedLinks"></p>
        <textarea class="form-control" rows="3"  placeholder="Please input some reason here"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Submit</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>
$.fn.dataTableExt.afnFiltering.push(
    function( oSettings, aData, iDataIndex ) {
        var iMin = document.getElementById('price_start').value * 1;
        var iMax = document.getElementById('price_end').value * 1;
        var iVersion = aData[4] == "-" ? 0 : aData[4]*1;
        if ( iMin == "" && iMax == "" )
        {
            return true;
        }
        else if ( iMin == "" && iVersion < iMax )
        {
            return true;
        }
        else if ( iMin < iVersion && "" == iMax )
        {
            return true;
        }
        else if ( iMin < iVersion && iVersion < iMax )
        {
            return true;
        }
        return false;
    }
);
	$(document).ready(function() {
    var oTable = $('#resultTable').dataTable({
    	 "sDom": '<"div">rt<"div"lp>',
    	"bProcessing": true,
        "sAjaxSource": '/query/query.json',
        "aoColumns": [
        	{"mData":null},
            { "mData": "image" },
            { "mData": "title" },
            { "mData": "location" },
            { "mData": "price" },
            { "mData": "seller" },
            { "mData": null },
            { "mData": "status" },
            { "mData": "action" }
        ],
        "aoColumnDefs": [
        	{
        		"mRender": function( data, type, row ) {
                    return "<input type='checkbox' data-id='"+ row['id'] +"'>";
	            },
	            "aTargets": [0]
        	},
        	{
        		"mRender": function( data, type, row ) {
                    return "<img src='"+ row['image'] +"'>";
	            },
	            "aTargets": [1]
        	},
        	{
        		"mRender": function( data, type, row ) {
                    return "<a target='_blank' href='"+ row['url'] +"'>"+row['title']+"</a>";
	            },
	            "aTargets": [2]
        	},
        	{
        		"mRender": function( data, type, row ) {
        			if(row['id']%3==0 || row['id']%5==0){
        				return "假货";	
        			}
					return "";                    
	            },
	            "aTargets": [6]
        	}
        ],
        "fnServerParams": function ( aoData ) {
            aoData.push( { "name":"brand_id", "value": $("#brand-select").val()} );
        }
    });
    
    
    $("#keyword-filter").keyup( function () {
        /* Filter on the column (the index) of this element */
        oTable.fnFilter( this.value, 2 );
    } );
    
    $('#price_start').keyup( function() { oTable.fnDraw(); } );
    $('#price_end').keyup( function() { oTable.fnDraw(); } );
    
    $("#complain").on('click',function(){
    	var checked = $("#resultTable input:checked");
    	
    	$("#selectedCount").html(checked.size());
    	var links = "<ul>";
    	for (var i=0; i < checked.size(); i++) {
    		if(i > 0){
    			links += "<br>";
    		}
    		links+= "<li>";
		  links += $(checked[i]).closest("tr").find("a").attr("href");
		  links+= "</li>";
		};
		links += "</ul>";
    	$("#selectedLinks").html(links);
    	$('.modal').modal();
    });
    
//    $('#resultTable tbody').on('dblclick', 'tr', function () {
//    	
//    });
});
</script>
